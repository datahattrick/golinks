<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{if .Title}}{{.Title}} - {{end}}{{if .SiteTitle}}{{.SiteTitle}}{{else}}GoLinks{{end}}</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="stylesheet" href="/static/css/fonts.css">
    <link rel="stylesheet" href="/static/css/tailwind.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="/static/js/htmx.min.js"></script>
    <script>
        // Dark mode (before any rendering)
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark')
        } else {
            document.documentElement.classList.remove('dark')
        }
    </script>
    <style>
        {{if .EnableAnimatedBackground}}
        /* Animated gradient background */
        .bg-animated {
            background: linear-gradient(-45deg, #f0fdfa, #ecfeff, #f0f9ff, #eff6ff, #f5f3ff);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        .dark .bg-animated {
            background: linear-gradient(-45deg, #022c22, #042f2e, #0c1929, #0f172a, #1e1b4b);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        {{else}}
        /* Static gradient background (performance-friendly) */
        .bg-static {
            background: linear-gradient(135deg, #f0fdfa 0%, #ecfeff 25%, #f0f9ff 50%, #eff6ff 75%, #f5f3ff 100%);
        }
        .dark .bg-static {
            background: linear-gradient(135deg, #022c22 0%, #042f2e 25%, #0c1929 50%, #0f172a 75%, #1e1b4b 100%);
        }
        {{end}}

        {{if .EnableAnimatedBackground}}
        /* Network nodes animation */
        .network-bg {
            position: fixed;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
            z-index: 0;
        }
        .network-node {
            position: absolute;
            border-radius: 50%;
            opacity: 0.35;
        }
        .dark .network-node {
            opacity: 0.18;
        }
        .node-1 {
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(6, 182, 212, 0.3) 0%, transparent 70%);
            top: 10%;
            left: 10%;
            animation: float 20s ease-in-out infinite;
        }
        .node-2 {
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.2) 0%, transparent 70%);
            top: 60%;
            right: 5%;
            animation: float 25s ease-in-out infinite reverse;
        }
        .node-3 {
            width: 250px;
            height: 250px;
            background: radial-gradient(circle, rgba(20, 184, 166, 0.25) 0%, transparent 70%);
            bottom: 20%;
            left: 30%;
            animation: float 22s ease-in-out infinite 2s;
        }
        .node-4 {
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.2) 0%, transparent 70%);
            top: 30%;
            right: 25%;
            animation: float 18s ease-in-out infinite 1s reverse;
        }
        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(30px, -40px) scale(1.05); }
            50% { transform: translate(-20px, 30px) scale(0.95); }
            75% { transform: translate(-40px, -20px) scale(1.02); }
        }

        /* Connection lines */
        .connection-lines {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
            opacity: 0.3;
        }
        .dark .connection-lines {
            opacity: 0.15;
        }
        .connection-lines svg {
            width: 100%;
            height: 100%;
        }
        .connection-line {
            stroke: url(#lineGradient);
            stroke-width: 1;
            fill: none;
            stroke-dasharray: 8 4;
            animation: dash 30s linear infinite;
        }
        @keyframes dash {
            to { stroke-dashoffset: -1000; }
        }
        {{else}}
        /* Static decorative elements (no animation) */
        .static-bg {
            position: fixed;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
            z-index: 0;
        }
        .static-node {
            position: absolute;
            border-radius: 50%;
            opacity: 0.25;
        }
        .dark .static-node {
            opacity: 0.12;
        }
        .static-node-1 {
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(6, 182, 212, 0.25) 0%, transparent 70%);
            top: 10%;
            left: 10%;
        }
        .static-node-2 {
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.15) 0%, transparent 70%);
            top: 60%;
            right: 5%;
        }
        .static-node-3 {
            width: 250px;
            height: 250px;
            background: radial-gradient(circle, rgba(20, 184, 166, 0.2) 0%, transparent 70%);
            bottom: 20%;
            left: 30%;
        }
        {{end}}

        /* Glass morphism cards */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 0, 0, 0.12);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }
        .dark .glass-card {
            background: rgba(15, 23, 42, 0.72);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        /* Nav active state (set via JS on page load) */
        .nav-link.nav-active {
            background-color: #ecfeff;
            color: #0891b2;
            font-weight: 500;
        }
        .dark .nav-link.nav-active {
            background-color: rgba(22, 78, 99, 0.3);
            color: #22d3ee;
            font-weight: 500;
        }
        .mobile-nav-link.nav-active {
            background-color: #ecfeff;
            color: #0891b2;
            font-weight: 500;
        }
        .dark .mobile-nav-link.nav-active {
            background-color: rgba(8, 51, 68, 0.4);
            color: #22d3ee;
            font-weight: 500;
        }

        /* Smooth scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(6, 182, 212, 0.3);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(6, 182, 212, 0.5);
        }
    </style>
</head>
<body class="h-full {{if .EnableAnimatedBackground}}bg-animated{{else}}bg-static{{end}} text-gray-900 dark:text-gray-100 transition-colors font-sans">
    {{if .EnableAnimatedBackground}}
    <!-- Animated background elements -->
    <div class="network-bg">
        <div class="network-node node-1"></div>
        <div class="network-node node-2"></div>
        <div class="network-node node-3"></div>
        <div class="network-node node-4"></div>
    </div>
    <div class="connection-lines">
        <svg preserveAspectRatio="none">
            <defs>
                <linearGradient id="lineGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#06b6d4;stop-opacity:0.5" />
                    <stop offset="50%" style="stop-color:#8b5cf6;stop-opacity:0.3" />
                    <stop offset="100%" style="stop-color:#14b8a6;stop-opacity:0.5" />
                </linearGradient>
            </defs>
            <path class="connection-line" d="M0,100 Q400,50 800,150 T1600,100" />
            <path class="connection-line" d="M0,300 Q300,250 600,350 T1200,300 T1800,280" style="animation-delay: -10s;" />
            <path class="connection-line" d="M0,500 Q500,400 1000,550 T2000,480" style="animation-delay: -20s;" />
        </svg>
    </div>
    {{else}}
    <!-- Static background elements (no animation for performance) -->
    <div class="static-bg">
        <div class="static-node static-node-1"></div>
        <div class="static-node static-node-2"></div>
        <div class="static-node static-node-3"></div>
    </div>
    {{end}}

    <!-- Content wrapper -->
    <div class="relative z-10 min-h-full flex flex-col">
        {{if .BannerText}}
        <div class="text-center px-4 py-1 text-xs font-medium" style="background-color: {{.BannerBGColor}}; color: {{.BannerTextColor}}">
            {{.BannerText}}
        </div>
        {{end}}
        {{template "partials/navbar" .}}

        <main class="flex-1 max-w-5xl w-full mx-auto px-4 py-6">
            {{embed}}
        </main>

        <footer class="relative z-10 text-center py-5 px-4 border-t border-gray-200/30 dark:border-gray-700/30">
            <p class="text-sm text-gray-500 dark:text-gray-500">{{if .SiteFooter}}{{.SiteFooter}}{{else}}GoLinks &middot; Fast URL shortcuts for your team{{end}}</p>
        </footer>
    </div>

    <!-- Confirm dialog -->
    <div id="confirm-modal" class="fixed inset-0 z-50 hidden">
        <div class="fixed inset-0 bg-gray-900/50 dark:bg-black/60 backdrop-blur-sm" id="confirm-backdrop"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="glass-card rounded-2xl shadow-xl max-w-sm w-full p-6 relative">
                <div class="flex items-center gap-3 mb-4">
                    <div class="flex-shrink-0 w-10 h-10 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center">
                        <svg class="w-5 h-5 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                        </svg>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Confirm</h3>
                </div>
                <p id="confirm-message" class="text-gray-700 dark:text-gray-300 mb-6"></p>
                <div class="flex justify-end gap-3">
                    <button id="confirm-cancel" class="px-4 py-2 text-sm font-medium rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors">Cancel</button>
                    <button id="confirm-ok" class="px-4 py-2 text-sm font-medium rounded-lg bg-red-600 text-white hover:bg-red-700 shadow-sm transition-colors">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleDarkMode() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark')
                localStorage.theme = 'light'
            } else {
                document.documentElement.classList.add('dark')
                localStorage.theme = 'dark'
            }
        }

        // Highlight the active nav link based on current path
        (function() {
            var path = window.location.pathname;
            document.querySelectorAll('.nav-link, .mobile-nav-link').forEach(function(link) {
                if (link.dataset.path === path) {
                    link.classList.add('nav-active');
                }
            });
        })();

        // Toggle mobile navigation menu
        function toggleMobileMenu() {
            var menu = document.getElementById('mobile-menu');
            var menuIcon = document.getElementById('menu-icon');
            var closeIcon = document.getElementById('close-icon');
            if (menu) menu.classList.toggle('hidden');
            if (menuIcon) menuIcon.classList.toggle('hidden');
            if (closeIcon) closeIcon.classList.toggle('hidden');
        }

        // Custom confirm dialog for HTMX
        (function() {
            var modal = document.getElementById('confirm-modal');
            var message = document.getElementById('confirm-message');
            var okBtn = document.getElementById('confirm-ok');
            var cancelBtn = document.getElementById('confirm-cancel');
            var backdrop = document.getElementById('confirm-backdrop');

            function hideModal() {
                modal.classList.add('hidden');
            }

            document.addEventListener('htmx:confirm', function(e) {
                if (!e.detail.question) return;
                e.preventDefault();
                message.textContent = e.detail.question;
                modal.classList.remove('hidden');

                var onConfirm, onCancel, onKey;
                function cleanup() {
                    okBtn.removeEventListener('click', onConfirm);
                    cancelBtn.removeEventListener('click', onCancel);
                    backdrop.removeEventListener('click', onCancel);
                    document.removeEventListener('keydown', onKey);
                }
                onConfirm = function() { cleanup(); hideModal(); e.detail.issueRequest(true); };
                onCancel = function() { cleanup(); hideModal(); };
                onKey = function(ke) { if (ke.key === 'Escape') onCancel(); else if (ke.key === 'Enter') onConfirm(); };

                okBtn.addEventListener('click', onConfirm);
                cancelBtn.addEventListener('click', onCancel);
                backdrop.addEventListener('click', onCancel);
                document.addEventListener('keydown', onKey);
                okBtn.focus();
            });
        })();
    </script>
</body>
</html>
